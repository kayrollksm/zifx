<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZIFX — Deposit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>body{font-family:Poppins,sans-serif}</style>
</head>

<body class="bg-[#0D1A1E] text-white">

<div id="sidebar"></div>

<main class="ml-64 p-8 max-w-xl">
  <h1 class="text-xl font-semibold mb-6">Deposit Funds</h1>

  <div class="border border-white/10 rounded-xl p-5 mb-6">
    <p class="text-sm text-[#7D8895]">Current Capital</p>
    <p id="currentCapital" class="text-2xl font-bold">RM 0</p>
  </div>

  <label class="block text-sm mb-2">Select Plan</label>
  <select id="planSelect" class="w-full px-4 py-3 rounded bg-[#121C27] mb-4">
    <option value="">-- Choose Plan --</option>
    <option value="starter" data-amount="1000">Starter — RM1,000</option>
    <option value="growth" data-amount="3000">Growth — RM3,000</option>
    <option value="pro" data-amount="5000">Pro — RM5,000</option>
  </select>

  <label class="block text-sm mb-2">Or Custom Amount (RM)</label>
  <input id="customAmount" type="number" min="1000"
    placeholder="Minimum RM1000"
    class="w-full px-4 py-3 rounded bg-[#121C27] mb-6">

  <button id="continueBtn"
    class="w-full bg-[#00A7A6] py-3 rounded font-semibold text-[#0D1A1E]">
    Continue to Payment
  </button>

  <p class="mt-4 text-xs text-[#7D8895]">
    Prototype only. No real payment required.
  </p>
</main>

<script>
/* LOAD SIDEBAR */
fetch("partials/sidebar.html")
  .then(r=>r.text())
  .then(h=>sidebar.innerHTML=h);

/* AUTH */
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
if (!currentUser || currentUser.role !== "user") {
  location.href = "../login.html";
}

/* CAPITAL */
document.getElementById("currentCapital").innerText =
  "RM " + (currentUser.capital || 0).toLocaleString();

/* SUBMIT */
document.getElementById("continueBtn").onclick = () => {
  const planEl = planSelect.selectedOptions[0];
  let amount = 0;
  let plan = "custom";

  if (planEl && planEl.dataset.amount) {
    amount = Number(planEl.dataset.amount);
    plan = planEl.value;
  } else {
    amount = Number(customAmount.value);
    if (amount < 1000) {
      alert("Minimum deposit RM1000");
      return;
    }
  }

  const tx = {
    id: "TX" + Date.now(),
    userId: currentUser.id,
    userName: currentUser.name,
    type: "deposit",
    plan,
    amount,
    status: "pending",
    createdAt: new Date().toISOString()
  };

  const txs = JSON.parse(localStorage.getItem("zifx_transactions")) || [];
  txs.push(tx);
  localStorage.setItem("zifx_transactions", JSON.stringify(txs));

  location.href = "payment.html?tx=" + tx.id;
};
</script>

</body>
</html>
